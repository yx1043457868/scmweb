webpackJsonp([7],{GUen:function(t,e){},L3Gz:function(t,e){},jcn8:function(t,e,r){t.exports=r.p+"static/img/jifen.a7769d5.jpg"},lPzR:function(t,e){},psli:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});r("OgVB");var a=r("/Lyv"),s=r.n(a),n=(r("34+y"),r("X+yh")),o=r.n(n),i=r("teIl"),c=r("Dd8w"),l=r.n(c),p=r("NYxO"),d=r("0xDb"),u={name:"preBar",data:function(){return{balls:[{show:!1},{show:!1},{show:!1},{show:!1},{show:!1}],dropBalls:[]}},computed:l()({},Object(p.a)(["preorderCount"]),{disabled:function(){return 0==this.preorderCount}}),methods:{commit:function(){this.$router.push({path:"/cofirmPreOrder"})},popupVisible:function(){this.$emit("popupOpen")},drop:function(t){for(var e=0;e<this.balls.length;e++){var r=this.balls[e];if(!r.show)return r.show=!0,r.el=t,void this.dropBalls.push(r)}},beforeDrop:function(t){for(var e=this.balls.length;e--;){var r=this.balls[e];if(r.show){var a=r.el.getBoundingClientRect(),s=a.left,n=-(window.innerHeight-a.top-52);t.style.display="",t.style.webkitTransform="translate3d(0,"+n+"px,0)",t.style.transform="translate3d(0,"+n+"px,0)";var o=t.getElementsByClassName("inner-hook")[0];o.style.webkitTransform="translate3d("+s+"px,0,0)",o.style.transform="translate3d("+s+"px,0,0)"}}},dropping:function(t,e){t.offsetHeight;this.$nextTick(function(){t.style.webkitTransform="translate3d(0,0,0)",t.style.transform="translate3d(0,0,0)";var r=t.getElementsByClassName("inner-hook")[0];r.style.webkitTransform="translate3d(0,0,0)",r.style.transform="translate3d(0,0,0)",t.addEventListener("transitionend",e)})},afterDrop:function(t){var e=this.dropBalls.shift();e&&(e.show=!1,t.style.display="none")}}},v={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("footer",{staticClass:"shop_cart"},[r("div",{staticClass:"gwcInfo",class:[t.preorderCount>0?"fill":""],on:{click:function(e){return e.stopPropagation(),t.popupVisible(e)}}},[r("i",{directives:[{name:"show",rawName:"v-show",value:t.preorderCount>0,expression:"preorderCount>0"}]},[t._v(t._s(t.preorderCount))])]),t._v(" "),r("button",{attrs:{type:"button",disabled:t.disabled},on:{click:t.commit}},[t._v("抢先拼购")])]),t._v(" "),r("div",{staticClass:"ball-container"},t._l(t.balls,function(e,a){return r("div",{key:a},[r("transition",{attrs:{name:"drop"},on:{"before-enter":t.beforeDrop,enter:t.dropping,"after-enter":t.afterDrop}},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"ball.show"}],staticClass:"ball"},[r("div",{staticClass:"inner inner-hook"})])])],1)}),0)])},staticRenderFns:[]};var f=r("VU/8")(u,v,!1,function(t){r("lPzR")},"data-v-cf22717e",null).exports,m=r("GQaK"),h=r("lRwf"),g={props:{food:{type:Object}},methods:{addCart:function(t,e){var r=this;if(!this.$store.state.logindata.logintoken)return s.a.confirm("请先登录系统").then(function(t){r.$router.push({path:"/login"})}).catch(function(){}),!1;var a=Object(d.d)(),n=e.companyId;if(!n)return s()("提示","当前货品不在预售门店范围内"),!1;if(n&&-1==n.indexOf(a))return s()("提示","当前货品不在预售门店范围内"),!1;if("N"==e.is_enable)return o()({message:"该商品已下架！",duration:950}),!1;this.food.count?this.food.count++:h.set(this.food,"count",1);var i=this.$store.state.preorder.findIndex(function(t){return t.id==e.id});-1===i||null==i||void 0==i?(e.value=e.minNum||1,e.checked=!0,this.$store.commit("addPrecarts",e),o()({message:"加入采购单成功！",duration:950}),this.$emit("addCart",t.target)):(e.checked=!0,this.$store.commit("addPreorder",i),o()({message:"加入采购单成功！",duration:950}),this.$emit("addCart",t.target))},decreaseCart:function(t){this.food.count&&this.food.count--;var e=this.$store.state.carts.findIndex(function(e){return e.id==t.id});-1===e||this.$store.commit("reduce",e)}}},_={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"cartcontrol"},[r("button",{staticClass:"cart-btn",on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.addCart(e,t.food)}}},[r("i",{staticClass:"iconfont addCart"},[t._v("")])])])},staticRenderFns:[]};var w=r("VU/8")(g,_,!1,function(t){r("GUen")},"data-v-06ae1d87",null).exports,C=r("p0f0"),b={name:"preorderList",components:{Header:i.a,precartcontrol:w,preBar:f,MescrollVue:C.a},data:function(){return{flag:!1,start_time:0,end_time:0,content:"0天00小时00分00秒",mescroll:null,mescrollDown:{},mescrollUp:{callback:this.upCallback,page:{num:0,size:10},htmlNodata:'<p class="upwarp-nodata">-- 没有更多了 --</p>',noMoreSize:5,toTop:{src:"/static/images/mescroll-totop.png",offset:1e3},empty:{warpId:"mescroll",icon:"/static/images/none.png",tip:"本期团购已结束，下期即将开团"}},popupPre:!1,preorderList:[]}},computed:{preorder:function(){return this.$store.state.preorder}},watch:{popupPre:function(){this.$nextTick(function(){this.popupPre&&this._initScroll()})}},filters:{formatMonth:function(t){if(!t)return"00.00";t=t.replace(new RegExp(/-/gm),"/");var e=new Date(t);return Object(d.c)(e,1)}},created:function(){this.selectAppPreactivity()},beforeRouteEnter:function(t,e,r){r(function(t){t.$refs.mescroll.beforeRouteEnter()})},beforeRouteLeave:function(t,e,r){this.$refs.mescroll.beforeRouteLeave(),r()},methods:{countdowm:function(t){var e=this,r=window.setInterval(function(){var a=new Date;t=t.replace(new RegExp(/-/gm),"/");var s=new Date(t).getTime()-a.getTime();if(s>0){var n=Math.floor(s/1e3/60/60/24),o=Math.floor(s/1e3/60/60%24),i=Math.floor(s/1e3/60%60),c=Math.floor(s/1e3%60);o=o<10?"0"+o:o,i=i<10?"0"+i:i,c=c<10?"0"+c:c;var l="";n>0&&(l=n+"天"+o+"小时"+i+"分"+c+"秒"),n<=0&&o>0&&(l=o+"小时"+i+"分"+c+"秒"),n<=0&&o<=0&&(l=i+"分"+c+"秒"),e.content="距结束还剩 "+l}else window.clearInterval(r),e.content="活动已结束"},1e3)},getTimeDay:function(t){var e=new Date,r=new Date(e.getFullYear()+"/"+(1*e.getMonth()+1)+"/"+e.getDate());t=t.replace(new RegExp(/-/gm),"/");var a=new Date(t).getTime()-r.getTime();if(a>0){var s=Math.floor(a/1e3/60/60/24);Math.floor(a/1e3/60/60%24),Math.floor(a/1e3/60%60),Math.floor(a/1e3%60);return s>0?s:1}return 1},clear:function(){this.$store.commit("clearPreOrder"),this.popupPre=!1},_initScroll:function(){this.sampleCart=new m.a(this.$refs.sampleCart,{click:!0,probeType:3})},appear:function(){this.popupPre=!this.popupPre},addFood:function(t){this._drop(t)},_drop:function(t){var e=this;this.$nextTick(function(){e.$refs.shopcart.drop(t)})},changeValue:function(t,e,r){var a=r.target.value;-1!=t.value.toString().indexOf(".")&&o()("该商品只能输入整数"),t.value=parseInt(a.toString().replace(/[^\d]+/g,""))||0,0!=t.value&&""!=t.value||(o()("礼品数量数量不能为空"),t.value=1)},addCart:function(t,e){this.$store.commit("addPreorder",e)},decreaseCart:function(t,e){var r=this;this.$store.state.preorder[e].value>t.minNum?this.$store.commit("reducePreorder",e):s.a.confirm(t.minNum+t.unit+"起预购,确定要删除该商品?").then(function(t){r.$store.commit("deletePreOrder",e)}).catch(function(){})},selectAppPreactivity:function(){var t=this;this.$post("/appPreOrder/selectAppPreactivity.do",{content:"{}",version:"kkllo",login_token:this.$store.getters.logintoken}).then(function(e){var r=JSON.parse(e);"yes"==r.optFlag?(t.start_time=r.res.startTime?r.res.startTime:0,t.end_time=r.res.endTime?r.res.endTime:0,t.countdowm(r.res.endTime)):t.$store.commit("clearPreOrder")}).catch(function(t){})},mescrollInit:function(t){this.mescroll=t},upCallback:function(t,e){var r=this,a='{"owner":"'+(this.$store.getters.company.owner||5500450)+'","pageSize": "'+t.size+'","page": "'+t.num+'"}';this.$post("/appPreOrder/selectAppPreProductList.do",{content:a,version:"kkllo",login_token:this.$store.getters.logintoken}).then(function(a){var s=JSON.parse(a),n=s.res.list;n&&n.map(function(t,e){return t.deliverDay=r.getTimeDay(t.sendEndtime),t}),"yes"==s.optFlag?(1===t.num&&(r.preorderList=[]),r.preorderList=r.preorderList.concat(n),r.$nextTick(function(){e.endSuccess(n.length)})):(r.preorderList=[],r.$nextTick(function(){e.endSuccess(0)}))}).catch(function(t){e.endErr()})}}},k={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Header",{attrs:{title:"拼猪猪"}}),t._v(" "),a("div",{staticClass:"my-content"},[a("div",{staticClass:"time-box"},[a("div",{staticClass:"month-round"},[a("span",{staticClass:"start-time"},[t._v(t._s(t._f("formatMonth")(t.start_time)))]),t._v("-"),a("span",{staticClass:"end-time"},[t._v(t._s(t._f("formatMonth")(t.end_time)))])]),t._v(" "),a("span",{staticClass:"content"},[t._v(t._s(t.content))])]),t._v(" "),a("mescroll-vue",{ref:"mescroll",attrs:{down:t.mescrollDown,up:t.mescrollUp},on:{init:t.mescrollInit}},[a("div",{attrs:{id:"mescroll"}},[a("div",{staticClass:"order-wrapper",staticStyle:{"padding-top":"0"}},[a("ul",{staticClass:"goods-list",attrs:{id:"goodsList"}},[a("li",[a("img",{staticClass:"jifenImg",attrs:{src:r("jcn8")}})]),t._v(" "),t._l(t.preorderList,function(e,r){return a("li",{key:r,staticClass:"mui-table-view-cell",attrs:{pid:e.id}},[a("router-link",{attrs:{to:{path:"/preDetail",query:{id:e.id}}}},[a("div",{staticClass:"food-link"},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.baseurl+e.imgPath,expression:"baseurl+food.imgPath"}]}),t._v(" "),a("div",{staticClass:"recommend"},[a("h4",{staticClass:"skuName"},[t._v(t._s(e.skuName))]),t._v(" "),a("p",{staticClass:"styleno"},[t._v("规格："+t._s(e.styleno))]),t._v(" "),a("p",{staticClass:"tip"},[t._v(t._s(e.minNum)+t._s(e.unit)+"起拼购 "),a("span",[t._v("下单预付"+t._s(e.preScale)+"%保价")]),t._v(" "),a("span",[t._v(t._s(e.deliverDay)+"天内到货")])]),t._v(" "),a("p",{staticClass:"styleno"},[t._v(t._s(e.lightMark))]),t._v(" "),a("div",{staticClass:"price"},[a("span",{staticStyle:{color:"#e75b5a",fontSize:"14px"}},[t._v("￥"+t._s(e.preunitPrice?e.preunitPrice:0)+"/"+t._s(e.unit))])])])]),t._v(" "),a("div",{staticClass:"cartcontrol-wrapper"},[a("precartcontrol",{attrs:{food:e},on:{addCart:t.addFood}})],1)])],1)})],2)])])])],1),t._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:t.popupPre,expression:"popupPre"}],staticClass:"dialogMask",attrs:{id:"dialogMask"},on:{click:function(e){t.popupPre=!1}}}),t._v(" "),a("transition",{attrs:{name:"slide","enter-active-class":"animated slideInUp","leave-active-class":"animated slideOutDown"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.popupPre,expression:"popupPre"}],staticClass:"dialog-wrapper",attrs:{id:"dialog"}},[a("div",{staticClass:"dialog-box"},[a("div",{staticClass:"popup"},[a("div",{staticClass:"popup-header"},[a("span",[t._v("已选商品")]),t._v(" "),a("span",{staticClass:"iconfont clearpopup",on:{click:t.clear}},[t._v("清空")])]),t._v(" "),a("div",{ref:"sampleCart",staticClass:"cart-wrapper"},[a("div",[a("ul",t._l(t.preorder,function(e,r){return a("li",{key:r,staticClass:"mui-input-row mui-checkbox mui-left"},[a("label",{staticClass:"sku_name"},[t._v(t._s(e.skuName))]),t._v(" "),a("div",{staticClass:"cartcontrol-wrapper",staticStyle:{right:"25px"}},[a("div",{staticClass:"cartcontrol"},[a("button",{staticClass:"cart-decrease",on:{click:function(a){a.stopPropagation(),a.preventDefault(),t.decreaseCart(e,r)}}},[t._v("-")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"car.value"}],staticClass:"cart-count",attrs:{type:"number",step:"1",min:"0",id:e.id,onkeyup:"value=value.replace(/[^\\d]+/g,'')",onpaste:"value=value.replace(/[^\\d]+/g,'')",oncontextmenu:"value=value.replace(/[^\\d]+/g,'')"},domProps:{value:e.value},on:{blur:function(a){t.changeValue(e,r,a)},input:function(r){r.target.composing||t.$set(e,"value",r.target.value)}}}),t._v(" "),a("button",{staticClass:"cart-add",on:{click:function(a){a.stopPropagation(),a.preventDefault(),t.addCart(e,r)}}},[t._v("+")])])]),t._v(" "),a("em",{staticClass:"uomDefault"},[t._v(t._s(e.uom_default))])])}),0)])])])])])]),t._v(" "),a("preBar",{ref:"shopcart",on:{popupOpen:t.appear}})],1)},staticRenderFns:[]};var y=r("VU/8")(b,k,!1,function(t){r("L3Gz")},"data-v-7e18c0bc",null);e.default=y.exports}});
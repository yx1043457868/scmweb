webpackJsonp([15],{lfXS:function(t,e){},qRVu:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s("34+y");var a=s("X+yh"),n=s.n(a),o=(s("OgVB"),s("/Lyv")),i=s.n(o),r=s("p0f0"),c=s("06cO"),l={name:"vpOrderList",components:{MescrollVue:r.a,searchPage:c.a},data:function(){return{searchText:"",search:!1,mescroll:null,mescrollDown:{},mescrollUp:{callback:this.upCallback,page:{num:0,size:10},htmlNodata:'<p class="upwarp-nodata">-- 没有更多了 --</p>',noMoreSize:5,empty:{warpId:"mescroll",icon:"static/images/none.png",tip:"暂无相关数据~"}},classId:this.$route.query.typeId||"",payStatus:this.$route.query.payStatus||"",currentIndex:0,popupVisible:!1,dataList:[{name:"全部",value:""},{name:"待审核",value:"7,8,9"},{name:"待配送",value:"1"},{name:"配送中",value:"2"},{name:"已签收",value:"3"},{name:"已取消",value:"4"},{name:"已支付",value:"pay"},{name:"未支付",value:"nopay"}],orderList:[]}},beforeRouteEnter:function(t,e,s){s(function(t){t.$refs.mescroll.beforeRouteEnter()})},beforeRouteLeave:function(t,e,s){this.$refs.mescroll.beforeRouteLeave(),s()},watch:{popupVisible:function(t){t?this.closeTouch():this.openTouch()}},computed:{orderTitle:function(){return""==this.classId&&""==this.payStatus?"全部订单":"7,8,9"==this.classId?"待审核订单":"1"==this.classId||"1,7,8,9"==this.classId?"待配送订单":"2"==this.classId?"配送中订单":"3"==this.classId?"已签收订单":"4"==this.classId?"已取消订单":""==this.classId&&"1"==this.payStatus?"已支付订单":""==this.classId&&"2"==this.payStatus?"未支付订单":void 0}},methods:{pay:function(t,e){window.location.href=location.origin+"/pay?orderCode="+t},hide:function(){this.search=!1},back:function(){if(window.history.length<=1)return this.$router.push({path:"/"}),!1;this.$router.push({path:"/userCenter"})},mescrollInit:function(t){this.mescroll=t},upCallback:function(t,e){var s=this,a='{"shopId":"'+this.$store.getters.account.shopId+'","searchText":"'+this.searchText+'","payStatus":"'+this.payStatus+'","handleStatus": "'+this.classId+'","pageSize": "'+t.size+'","pageNo": "'+t.num+'"}';this.$post("/appVpOrder/orderList.do",{content:a,version:"kkllo",login_token:this.$store.getters.logintoken}).then(function(a){var n=JSON.parse(a).res.orders;1===t.num&&(s.orderList=[]),s.orderList=s.orderList.concat(n),s.$nextTick(function(){e.endSuccess(n.length)})}).catch(function(t){e.endErr()})},chosen:function(t,e){this.currentIndex=t,"nopay"==e?(this.classId="",this.payStatus="2"):"pay"==e?(this.classId="",this.payStatus="1"):(this.classId=e,this.payStatus="")},reset:function(){this.currentIndex=0,this.classId="",this.payStatus="",this.searchText=""},sureOrder:function(t,e){var s=this;i.a.confirm("确定签收吗?").then(function(a){var o=s.$store.getters.account.account,i="{'orderCode':'"+t+"','account':'"+o+"'}";s.$post("/appVpOrder/receiveOrderBySale.do",{content:i,version:"kkllo",login_token:s.$store.getters.logintoken}).then(function(t){var a=JSON.parse(t);"yes"==a.optFlag?(""!=s.classId?s.orderList.splice(e,1):s.orderList[e].handleStatus=3,n()(a.optDesc)):n()(a.optDesc)})}).catch(function(){})},comfirm:function(){this.popupVisible=!1,this.mescroll.resetUpScroll()},handleSearch:function(t){this.search=!1,this.searchText=t,this.comfirm()},closeTouch:function(){document.getElementsByTagName("body")[0].addEventListener("touchmove",this.handler,{passive:!1})},openTouch:function(){document.getElementsByTagName("body")[0].removeEventListener("touchmove",this.handler,{passive:!1})},cancelOrder:function(t,e){var s=this;i.a.confirm("确定取消该订单吗?").then(function(a){var o=s.$store.getters.company.owner,i=s.$store.getters.account.account,r="{'orderCode':'"+t+"','account':'"+i+"','owner':'"+o+"'}";s.$post("/appVpOrder/cancelOrder.do",{content:r,version:"kkllo",login_token:s.$store.getters.logintoken}).then(function(t){var a=JSON.parse(t);"yes"==a.optFlag?(""!=s.classId?s.orderList.splice(e,1):s.orderList[e].handleStatus=4,n()(a.optDesc)):n()(a.optDesc)})}).catch(function(){})}}},u={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"header"},[s("mt-header",{attrs:{title:t.orderTitle}},[s("mt-button",{attrs:{slot:"left",icon:"back"},on:{click:t.back},slot:"left"}),t._v(" "),s("mt-button",{attrs:{slot:"right",icon:""},on:{click:function(e){t.popupVisible=!0}},slot:"right"},[s("i",{staticClass:"iconfont",staticStyle:{"font-size":"24px"}},[t._v("")])])],1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.popupVisible,expression:"popupVisible"}],staticClass:"mint-popup right-popup mint-popup-right",on:{click:function(e){t.popupVisible=!1}}}),t._v(" "),s("transition",{attrs:{name:"slide","enter-active-class":"animated slideInRight","leave-active-class":"animated slideOutRight"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.popupVisible,expression:"popupVisible"}],staticClass:"popup-model"},[s("div",{staticClass:"model-wrap"},[s("div",{staticClass:"model-content"},[s("h5",{staticClass:"model-t"},[s("span",[t._v("订单状态")])]),t._v(" "),s("div",{staticClass:"model-item"},t._l(t.dataList,function(e,a){return s("button",{key:a,class:{active:t.currentIndex===a},on:{click:function(s){t.chosen(a,e.value)}}},[t._v(t._s(e.name))])}),0)])]),t._v(" "),s("div",{staticClass:"handle-btn"},[s("button",{staticClass:"comfirm",on:{click:t.comfirm}},[t._v("确定")])])])]),t._v(" "),s("mescroll-vue",{ref:"mescroll",attrs:{down:t.mescrollDown,up:t.mescrollUp},on:{init:t.mescrollInit}},[s("div",{attrs:{id:"mescroll"}},[s("div",{staticClass:"order-wrapper"},[s("ul",t._l(t.orderList,function(e,a){return s("li",{key:a,staticClass:"order-list"},[s("div",{staticClass:"list-h clearfix"},[s("span",{staticClass:"mui-pull-left",staticStyle:{"font-weight":"500"}},[s("span",{staticClass:"iconfont def"},[t._v("")]),t._v(t._s(e.orderCode))]),t._v(" "),s("span",{staticClass:"orderSt mui-pull-right"},[1==e.handleStatus?s("em",{staticClass:"blue"},[t._v("待配送")]):2==e.handleStatus?s("em",{staticClass:"blue"},[t._v("配送中")]):3==e.handleStatus?s("em",{staticClass:"green"},[t._v("已签收")]):4==e.handleStatus?s("em",{staticClass:"gray"},[t._v("已取消")]):7==e.handleStatus||8==e.handleStatus||9==e.handleStatus?s("em",{staticClass:"blue"},[t._v("待审核")]):t._e()])]),t._v(" "),s("div",{staticClass:"order-info clearfix"},[s("p",{staticClass:"order-title"},[t._v("采购时间："+t._s(e.createTime))]),t._v(" "),s("p",{staticClass:"order-title"},[t._v("采购品类："+t._s(e.skuNum))]),t._v(" "),s("p",{staticClass:"order-title"},[t._v("应付金额：￥"+t._s(t._f("toFixed2")(e.mustAmount-e.couponAmount-e.returnSumAmount))+"\n                                "),e.returnCount>0?s("span",[t._v("（含退货）")]):t._e()]),t._v(" "),"1"==e.payStatus?s("p",{staticClass:"order-title"},[t._v("支付状态："),s("span",{staticStyle:{color:"#000"}},[t._v("已支付")])]):s("p",{staticClass:"order-title"},[t._v("支付状态："),s("span",{staticStyle:{color:"red"}},[t._v("未支付")])])]),t._v(" "),s("div",{staticClass:"list-b clearfix"},[s("router-link",{staticClass:"mui-btn",attrs:{to:{path:"/vpOrderDetail",query:{id:e.orderCode}},tag:"button"}},[t._v("\n                                查看详情\n                            ")]),t._v(" "),8==e.handleStatus||9==e.handleStatus?s("button",{staticClass:"mui-btn",on:{click:function(s){t.cancelOrder(e.orderCode,a)}}},[t._v("\n                                取消订单\n                            ")]):t._e(),t._v(" "),2==e.handleStatus?s("button",{on:{click:function(s){t.sureOrder(e.orderCode,a)}}},[t._v("\n                                确认收货\n                            ")]):t._e(),t._v(" "),"4"!=e.handleStatus&&"1"!=e.payStatus?s("router-link",{staticClass:"mui-btn",attrs:{to:{path:"/pay",query:{orderCode:e.orderCode}},tag:"button"}},[t._v("\n                                立即支付\n                            ")]):t._e()],1)])}),0)])])]),t._v(" "),s("searchPage",{directives:[{name:"show",rawName:"v-show",value:t.search,expression:"search"}],attrs:{placeholder:"请输入订单号/客户名称/客户账号"},on:{hide:t.hide,handleSearch:t.handleSearch}})],1)},staticRenderFns:[]};var d=s("VU/8")(l,u,!1,function(t){s("lfXS")},"data-v-fa10ac0c",null);e.default=d.exports}});
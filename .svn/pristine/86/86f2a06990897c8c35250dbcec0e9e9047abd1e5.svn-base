webpackJsonp([32],{aAGs:function(t,e){},qRVu:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s("34+y");var a=s("X+yh"),o=s.n(a),n=(s("OgVB"),s("/Lyv")),r=s.n(n),i=s("p0f0"),c=s("06cO"),l=s("0xDb"),u={name:"vpOrderList",components:{MescrollVue:i.a,searchPage:c.a},data:function(){return{searchText:"",search:!1,mescroll:null,mescrollDown:{},mescrollUp:{callback:this.upCallback,page:{num:0,size:10},htmlNodata:'<p class="upwarp-nodata">-- 没有更多了 --</p>',noMoreSize:5,empty:{warpId:"mescroll",icon:"static/images/none.png",tip:"暂无相关数据~"}},classId:this.$route.query.typeId||"",payStatus:this.$route.query.payStatus||"",currentIndex:0,popupVisible:!1,dataList:[{name:"全部",value:""},{name:"待审核",value:"7,8,9"},{name:"待配送",value:"1"},{name:"配送中",value:"2"},{name:"已签收",value:"3"},{name:"已取消",value:"4"},{name:"已支付",value:"pay"},{name:"未支付",value:"nopay"}],orderList:[],meckShow:!1,shopManager:this.$store.getters.company?this.$store.getters.company.contactName:"",shopManagerTel:this.$store.getters.company?this.$store.getters.company.contactPhone:"×××",refundOrderList:{},refundOrderIndex:-1}},beforeRouteEnter:function(t,e,s){s(function(t){t.$refs.mescroll.beforeRouteEnter()})},beforeRouteLeave:function(t,e,s){this.$refs.mescroll.beforeRouteLeave(),s()},watch:{popupVisible:function(t){t?this.closeTouch():this.openTouch()}},computed:{orderTitle:function(){return""==this.classId&&""==this.payStatus?"全部订单":"7,8,9"==this.classId?"待审核订单":"1"==this.classId||"1,7,8,9"==this.classId?"待配送订单":"2"==this.classId?"配送中订单":"3"==this.classId?"已签收订单":"4"==this.classId?"已取消订单":""==this.classId&&"1"==this.payStatus?"已支付订单":""==this.classId&&"2"==this.payStatus?"未支付订单":void 0}},methods:{pay:function(t,e){window.location.href=location.origin+"/pay?orderCode="+t},hide:function(){this.search=!1},back:function(){if(window.history.length<=1)return this.$router.push({path:"/"}),!1;this.$router.push({path:"/userCenter"})},mescrollInit:function(t){this.mescroll=t},upCallback:function(t,e){var s=this,a='{"shopId":"'+this.$store.getters.account.shopId+'","searchText":"'+this.searchText+'","payStatus":"'+this.payStatus+'","handleStatus": "'+this.classId+'","pageSize": "'+t.size+'","pageNo": "'+t.num+'"}';this.$post("/appVpOrder/orderList.do",{content:a,version:"kkllo",login_token:this.$store.getters.logintoken}).then(function(a){var o=JSON.parse(a).res.orders;1===t.num&&(s.orderList=[]),s.orderList=s.orderList.concat(o),s.$nextTick(function(){e.endSuccess(o.length)})}).catch(function(t){e.endErr()})},chosen:function(t,e){this.currentIndex=t,"nopay"==e?(this.classId="",this.payStatus="2"):"pay"==e?(this.classId="",this.payStatus="1"):(this.classId=e,this.payStatus="")},reset:function(){this.currentIndex=0,this.classId="",this.payStatus="",this.searchText=""},sureOrder:function(t,e){var s=this;r.a.confirm("确定签收吗?").then(function(a){var n=s.$store.getters.account.account,r="{'orderCode':'"+t+"','account':'"+n+"'}";s.$post("/appVpOrder/receiveOrderBySale.do",{content:r,version:"kkllo",login_token:s.$store.getters.logintoken}).then(function(t){var a=JSON.parse(t);"yes"==a.optFlag?(""!=s.classId?s.orderList.splice(e,1):s.orderList[e].handleStatus=3,o()(a.optDesc)):o()(a.optDesc)})}).catch(function(){})},refundOrder:function(t,e){t.wmsStatus&&100==t.wmsStatus?o()("订单已拣货出库，不能退款"):(this.meckShow=!0,this.refundOrderList=t.orderCode,this.refundOrderIndex=e)},configRefund:function(){var t=this,e=this.$store.getters.account.account,s="{'orderCode':'"+this.refundOrderList+"','account':'"+e+"'}";this.$post("/appVpOrder/cancelOrderByCustom.do",{content:s,version:"kkllo",login_token:this.$store.getters.logintoken}).then(function(e){var s=JSON.parse(e);s.optFlag?(t.meckShow=!1,t.orderList[t.refundOrderIndex].handleStatus=4,o()("退款申请已提交，请等待后台审核")):o()(s.optDesc)})},comfirm:function(){this.popupVisible=!1,this.mescroll.resetUpScroll()},handleSearch:function(t){this.search=!1,this.searchText=t,this.comfirm()},closeTouch:function(){document.getElementsByTagName("body")[0].addEventListener("touchmove",this.handler,{passive:!1})},openTouch:function(){document.getElementsByTagName("body")[0].removeEventListener("touchmove",this.handler,{passive:!1})},cancelOrder:function(t,e){var s=this;r.a.confirm("确定取消该订单吗?").then(function(a){var n=s.$store.getters.company.owner,r=s.$store.getters.account.account,i="{'orderCode':'"+t+"','account':'"+r+"','owner':'"+n+"'}";s.$post("/appVpOrder/cancelOrder.do",{content:i,version:"kkllo",login_token:s.$store.getters.logintoken}).then(function(t){var a=JSON.parse(t);"yes"==a.optFlag?(""!=s.classId?s.orderList.splice(e,1):s.orderList[e].handleStatus=4,o()(a.optDesc)):o()(a.optDesc)})}).catch(function(){o()("操作取消")})},recurOrder:function(t){var e=this,s='{"orderCode": "'+t+'"}';this.$post("/appVpOrder/orderDetailForSale.do",{content:s,version:"kkllo",login_token:this.$store.getters.logintoken}).then(function(t){var s=JSON.parse(t);if("yes"==s.optFlag){var a=e.$store.state.carts&&e.$store.state.carts.map(function(t,e){return t.checked=!1,t});e.$store.commit("setcarts",a);var n=s.res.skuList;n.map(function(t,s){var a={},o=e.$store.state.carts.findIndex(function(e){return e.id==t.productId});-1===o||null==o||void 0==o?(1==t.equation_factor?a.value=t.qty:(a.mnum_value=Object(l.m)(parseFloat(t.qty)||0,parseFloat(t.equation_factor)||1),a.value=parseInt(t.qty/parseFloat(t.equation_factor))),a.id=t.productId,a.checked=!0,a.img_path=t.img_path,a.price=t.price,a.retail_flag=t.retail_flag,a.sku_code=t.sku_code?t.sku_code:t.skuCode,a.sku_name=t.sku_name?t.sku_name:t.skuName,a.sku_type=t.sku_type?t.sku_type:t.skuType,a.styleno=t.styleno,a.unit=t.unit,a.unit_price=t.unit_price,a.uom_default=t.uom_default,e.$store.commit("addcarts",a)):((a=e.$store.state.carts[o]).checked=!0,1==t.equation_factor?a.value=t.qty:(a.mnum_value=Object(l.m)(parseFloat(t.qty)||0,parseFloat(t.equation_factor)||1),a.value=parseInt(t.qty/parseFloat(t.equation_factor))),e.$store.commit("shanchu",o),e.$store.commit("addcarts",a)),e.$router.push({path:"/shopCart"})})}else o()(s.optDesc)})}}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"header"},[s("mt-header",{attrs:{title:t.orderTitle}},[s("mt-button",{attrs:{slot:"left",icon:"back"},on:{click:t.back},slot:"left"}),t._v(" "),s("mt-button",{attrs:{slot:"right",icon:""},on:{click:function(e){t.popupVisible=!0}},slot:"right"},[s("i",{staticClass:"iconfont",staticStyle:{"font-size":"24px"}},[t._v("")])])],1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.popupVisible,expression:"popupVisible"}],staticClass:"mint-popup right-popup mint-popup-right",on:{click:function(e){t.popupVisible=!1}}}),t._v(" "),s("transition",{attrs:{name:"slide","enter-active-class":"animated slideInRight","leave-active-class":"animated slideOutRight"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.popupVisible,expression:"popupVisible"}],staticClass:"popup-model"},[s("div",{staticClass:"model-wrap"},[s("div",{staticClass:"model-content"},[s("h5",{staticClass:"model-t"},[s("span",[t._v("订单状态")])]),t._v(" "),s("div",{staticClass:"model-item"},t._l(t.dataList,function(e,a){return s("button",{key:a,class:{active:t.currentIndex===a},on:{click:function(s){t.chosen(a,e.value)}}},[t._v(t._s(e.name))])}),0)])]),t._v(" "),s("div",{staticClass:"handle-btn"},[s("button",{staticClass:"comfirm",on:{click:t.comfirm}},[t._v("确定")])])])]),t._v(" "),s("mescroll-vue",{ref:"mescroll",attrs:{down:t.mescrollDown,up:t.mescrollUp},on:{init:t.mescrollInit}},[s("div",{attrs:{id:"mescroll"}},[s("div",{staticClass:"order-wrapper"},[s("ul",t._l(t.orderList,function(e,a){return s("li",{key:a,staticClass:"order-list"},[s("div",{staticClass:"list-h clearfix"},[s("span",{staticClass:"mui-pull-left",staticStyle:{"font-weight":"500"}},[s("span",{staticClass:"iconfont def"},[t._v("")]),t._v(t._s(e.orderCode))]),t._v(" "),s("span",{staticClass:"orderSt mui-pull-right"},[1==e.handleStatus?s("em",{staticClass:"blue"},[t._v("待配送")]):2==e.handleStatus?s("em",{staticClass:"blue"},[t._v("配送中")]):3==e.handleStatus?s("em",{staticClass:"green"},[t._v("已签收")]):4==e.handleStatus?s("em",{staticClass:"gray"},[t._v("已取消")]):7==e.handleStatus||8==e.handleStatus||9==e.handleStatus?s("em",{staticClass:"blue"},[t._v("待审核")]):t._e()])]),t._v(" "),s("div",{staticClass:"order-info clearfix"},[s("p",{staticClass:"order-title"},[t._v("采购时间："+t._s(e.createTime))]),t._v(" "),s("p",{staticClass:"order-title"},[t._v("采购品类："+t._s(e.skuNum))]),t._v(" "),s("p",{staticClass:"order-title"},[t._v("应付金额：￥"+t._s(t._f("toFixed2")(e.mustAmount-e.couponAmount-e.returnSumAmount))+"\n                                "),e.returnCount>0?s("span",[t._v("（含退货）")]):t._e()]),t._v(" "),"1"==e.payStatus?s("p",{staticClass:"order-title"},[t._v("支付状态："),s("span",{staticStyle:{color:"#000"}},[t._v("已支付")])]):s("p",{staticClass:"order-title"},[t._v("支付状态："),s("span",{staticStyle:{color:"red"}},[t._v("未支付")])])]),t._v(" "),s("div",{staticClass:"list-b clearfix"},[s("button",{on:{click:function(s){t.recurOrder(e.orderCode,a)}}},[t._v("\n                                再来一单\n                            ")]),t._v(" "),s("router-link",{staticClass:"mui-btn",attrs:{to:{path:"/vpOrderDetail",query:{id:e.orderCode}},tag:"button"}},[t._v("\n                                查看详情\n                            ")]),t._v(" "),7==e.handleStatus||8==e.handleStatus||9==e.handleStatus?s("button",{staticClass:"mui-btn",on:{click:function(s){t.cancelOrder(e.orderCode,a)}}},[t._v("\n                                取消订单\n                            ")]):t._e(),t._v(" "),2==e.handleStatus?s("button",{on:{click:function(s){t.refundOrder(e,a)}}},[t._v("\n                                退款\n                            ")]):t._e(),t._v(" "),2==e.handleStatus?s("button",{on:{click:function(s){t.sureOrder(e.orderCode,a)}}},[t._v("\n                                确认收货\n                            ")]):t._e(),t._v(" "),"4"!=e.handleStatus&&"1"!=e.payStatus?s("router-link",{staticClass:"mui-btn",attrs:{to:{path:"/pay",query:{orderCode:e.orderCode}},tag:"button"}},[t._v("\n                                立即支付\n                            ")]):t._e()],1)])}),0)])])]),t._v(" "),s("searchPage",{directives:[{name:"show",rawName:"v-show",value:t.search,expression:"search"}],attrs:{placeholder:"请输入订单号/客户名称/客户账号"},on:{hide:t.hide,handleSearch:t.handleSearch}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.meckShow,expression:"meckShow"}],staticClass:"meck"},[s("div",{staticClass:"meckBack"},[s("h3",[t._v("退款申请")]),t._v(" "),s("div",{staticClass:"meckContent"},[s("div",{staticClass:"meckContents"},[t._v("是否确认提交退款申请")]),t._v(" "),s("div",[t._v("如有疑问，您可以直接联系店长")]),t._v(" "),s("div",[t._v("店长："+t._s(t.shopManager))]),t._v(" "),s("div",[t._v("店长电话："+t._s(t.shopManagerTel))])]),t._v(" "),s("div",{staticClass:"meckBtn"},[s("button",{staticClass:"mui-btn",staticStyle:{color:"#eb6000"}},[s("a",{attrs:{href:"tel:"+t.shopManagerTel}},[t._v("联系店长")])]),t._v(" "),s("button",{staticClass:"mui-btn",on:{click:t.configRefund}},[t._v("确认提交")])])]),t._v(" "),s("div",{staticClass:"sharedcancel"},[s("i",{staticClass:"iconfont",on:{click:function(e){e.stopPropagation(),t.meckShow=!1}}},[t._v("")])])])],1)},staticRenderFns:[]};var p=s("VU/8")(u,d,!1,function(t){s("aAGs")},"data-v-782eea65",null);e.default=p.exports}});